<!doctype html>
<html lang="en">
  <head>
    <!-- Load TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.14.1/dist/tf.min.js"> </script>

    <script>
	
	function getUrlParams(search) {
		let hashes = search.slice(search.indexOf('?') + 1).split('&')
		let params = {}
		hashes.map(hash => {
			let [key, val] = hash.split('=')
			params[key] = decodeURIComponent(val)
		})

		return params
	}
	async function getModel(){
		const model = await tf.loadModel('https://raw.githubusercontent.com/bloc97/bloc97.github.io/master/azurlane/model.json');
		return model;
	}
	function show(num, scale) {
		getModel().then(model => {
			if (scale < 1) {
				scale = 1;
			}
			
			//var body = document.getElementsByTagName("body")[0];
			var body = document.getElementById("canvases");
			for (var i=0; i<num; i++) {
				
				var canvas = document.createElement('canvas');

				canvas.id = "output"+i;
				canvas.width = 48;
				canvas.height = 48;
				canvas.style.zIndex = 8;
				//canvas.style.position = "absolute";
				canvas.style.border = "4px solid white";

				body.appendChild(canvas);
				
				const latent = tf.clipByValue(tf.randomNormal([1, 1, 1, 64]), -2, 2);
				var image = tf.add(tf.div(tf.reshape(model.predictOnBatch(latent), [48, 48, 3]), 2), 0.5);
				image = tf.image.resizeNearestNeighbor(image, [48 * Math.floor(scale), 48 * Math.floor(scale)])
				tf.toPixels(image, canvas)
			}
			document.getElementById("placeholder").remove();
			document.getElementById("placeholder2").remove();
			
			var paramdesc = document.createElement('div');
			paramdesc.innerHTML = 'Query parameters: azurlane/?num=' + num + '&scale=' + scale;
			body.appendChild(paramdesc);
		});
	}
	
	var currenthref = window.location.href;
	//console.log(currenthref)
	const params = getUrlParams(currenthref);
	
	const num = params.num || 27
	const scale = params.scale || 4
	
	
	show(num, scale);
	  
    </script>
  </head>

  <body>
	<div id='placeholder'>
		<h2>Dreaming up ship girls, please wait...</h2>
	</div>
	<div id='canvases'>
	</div>
	<br/>
	Note: This is powered by TensorFlow.js and runs locally in your computer.<br/><br/><br/>
	
	<div id='placeholder2'>
	If you do not have a graphics card it may take a few minutes.<br/>
	Consider reducing the amount of images generated using the "num" parameter.<br/>
	Eg. https://bloc97.github.io/azurlane/?num=4
	</div>
  </body>
</html>