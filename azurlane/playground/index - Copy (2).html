<!doctype html>
<html lang="en">
  <head>
    <!-- Load TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.14.1/dist/tf.min.js"></script>
	<script src="../data/utils.js" type="text/javascript"></script>

    <script>
	
	var canvas = document.getElementById("image");
	var latent_size = 64;
	var latent = tf.randomUniform([latent_size,], -1, 1);
	
	function refresh_sliders() {
		latent = tf.clipByValue(latent, -1.5, 1.5);
		var latent_buffer = latent.buffer();
		for (var i=0; i<latent_size; i++) {
			sliders[i].value = latent_buffer.get(i);
			sliders_value[i].innerHTML = sliders[i].value;
		}
	}
	
	function randomize() {
		latent = tf.randomUniform([latent_size,], -1, 1);
		refresh_sliders();
		show();
	}
	
	function nudge() {
		latent = tf.add(latent, tf.mul(tf.randomNormal([latent_size,]), nudge_strength));
		refresh_sliders();
		show();
	}
	
	
	
	const sliders = [];
	const sliders_value = [];
	
	var nudge_strength = 0.2;
		
	var currenthref = window.location.href;
	const params = getUrlParams(currenthref);
	const num = params.num || 32;
	const scale = params.scale || 8;
	
	window.onload = function(){
	
		canvas = document.getElementById("image");
		var latent_buffer = latent.buffer();
		
		sliders_dom = document.getElementById("sliders");
		
		
		var var_slider = document.createElement('input');
		var_slider.type = 'range';
		var_slider.min = '0.1';
		var_slider.max = '0.5';
		var_slider.step = '0.01';
		var_slider.value = nudge_strength;
		var_slider.class = 'slider';
		
		var_slider.oninput = function() {
			nudge_strength = parseFloat(this.value);
			show();
		}
		sliders_dom.appendChild(var_slider);
		sliders_dom.appendChild(document.createElement('br'));
		
		for (var i=0; i<latent_size; i++) {
			var slider = document.createElement('input');
			slider.type = 'range';
			slider.min = '-1.5';
			slider.max = '1.5';
			slider.step = '0.01';
			//slider.value = latent_buffer.get(i);
			slider.class = 'slider';
			
			var slider_value = document.createElement('span');
			
			const slider_i = i;
			slider.oninput = function() {
				//slider_value.innerHTML = this.value;
				var latent_buffer = latent.buffer();
				latent_buffer.set(this.value, slider_i);
				latent = latent_buffer.toTensor();
				show();
			}
			
			sliders.push(slider);
			sliders_value.push(slider_value);
			
			
			slider.appendChild(slider_value);
			sliders_dom.appendChild(slider);
			
			//var br = document.createElement('br');
			//sliders_dom.appendChild(br);
			
		}
		
		
		refresh_sliders();
		
	
	
		
		show();
	};
	
	  
    </script>
	<style>
		
		.slider {
		  -webkit-appearance: none;
		  width: 50%;
		  height: 25px;
		  background: #d3d3d3;
		  outline: none;
		  opacity: 0.7;
		  -webkit-transition: .2s;
		  transition: opacity .2s;
		}

		.slider:hover {
		  opacity: 1;
		}

		.slider::-webkit-slider-thumb {
		  -webkit-appearance: none;
		  appearance: none;
		  width: 25px;
		  height: 25px;
		  background: #4CAF50;
		  cursor: pointer;
		}

		.slider::-moz-range-thumb {
		  width: 25px;
		  height: 25px;
		  background: #4CAF50;
		  cursor: pointer;
		}
	</style>
  </head>

  <body>
	<button type="button" onclick='randomize()'>Randomize!</button>
	<button type="button" onclick='nudge()'>Nudge!</button>
	<div id='canvases'>
		<canvas id='image'></canvas>
	</div>
	<div id='sliders'>
	</div>
	<br/>
  </body>
</html>